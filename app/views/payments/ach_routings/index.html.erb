<!-- app/views/payments/ach_routings/index.html.erb -->
<div class="flex items-center justify-between">
  <h1 class="text-2xl font-semibold">ACH Routings</h1>
  <div class="flex items-center gap-3">
    <div class="text-sm opacity-70"><%= number_with_delimiter(@routings.size) %> shown</div>
    <%= link_to new_payments_ach_routing_path, class: "btn btn-ghost btn-sm gap-2" do %>New<% end %>
  </div>
</div>

  <!-- Filters -->
  <div class="card bg-base-100 shadow">
    <div class="card-body">
      <form method="get" class="grid gap-3 md:grid-cols-4">
        <label class="form-control w-full md:col-span-2">
          <div class="label"><span class="label-text">Search</span></div>
          <label class="input input-bordered flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M10 4a6 6 0 104.472 10.03l3.75 3.75 1.415-1.414-3.75-3.75A6 6 0 0010 4zm0 2a4 4 0 110 8 4 4 0 010-8z"/></svg>
            <input
              type="text"
              name="q"
              value="<%= h params[:q] %>"
              placeholder="routing number, institution, city"
              class="grow"
            >
          </label>
        </label>

        <label class="form-control w-full">
          <div class="label"><span class="label-text">State</span></div>
          <select name="state" class="select select-bordered">
            <option value="">All</option>
            <% Payments::AchRoutingsHelper::US_STATES.each do |abbr| %>
              <option value="<%= abbr %>" <%= "selected" if params[:state] == abbr %>><%= abbr %></option>
            <% end %>
          </select>
        </label>

        <label class="form-control w-full">
          <div class="label"><span class="label-text">Per page</span></div>
          <select name="limit" class="select select-bordered">
            <% [25,50,100,200].each do |n| %>
              <option value="<%= n %>" <%= "selected" if @limit.to_i == n %>><%= n %></option>
            <% end %>
          </select>
        </label>

        <div class="md:col-span-4 flex gap-2">
          <button type="submit" class="btn btn-primary">Apply</button>
          <a href="<%= url_for(only_path: true) %>" class="btn btn-ghost">Reset</a>
        </div>
      </form>
    </div>
  </div>

<!-- Results -->
<div class="card bg-base-100 shadow">
  <div class="card-body p-0">
    <% if @routings.empty? %>
      <div class="p-6">
        <div class="alert"><span>No results. Adjust filters and try again.</span></div>
      </div>
    <% else %>
      <div class="overflow-x-auto">
        <table class="table table-zebra table-sm table-pin-rows">
          <thead>
            <tr>
              <th>Routing</th>
              <th>Institution</th>
              <th class="hidden md:table-cell">City</th>
              <th>State</th>
              <th class="hidden lg:table-cell">FRB</th>
            </tr>
          </thead>
          <tbody>
            <% @routings.each do |r| %>
              <tr>
                <td class="font-mono">
                  <%= link_to r.routing_number, payments_ach_routing_path(r), class: "link link-primary" %>
                </td>
                <td class="max-w-[36ch] truncate"><%= hl(r.customer_name, params[:q]) %></td>
                <td class="hidden md:table-cell"><%= hl(r.city, params[:q]) %></td>
                <td><%= r.state_code %></td>
                <td class="hidden lg:table-cell">
                <% if (b = r.frb_branch) %>
                  <span class="badge badge-sm badge-accent ml-2"><%= b.city %></span>
                <% end %>
              </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <div class="px-4 py-3 text-sm opacity-70">
        Showing <%= @range_start %>–<%= @range_end %>
      </div>
    <% end %>
  </div>
</div>


  <!-- Pagination -->
  <div class="flex items-center justify-between">
    <div class="text-sm opacity-70">
      Offset <%= @offset %> • Limit <%= @limit %>
    </div>
    <div class="join">
      <%= link_to "« Prev",
                  url_for(request.query_parameters.merge(offset: @prev_off, limit: @limit)),
                  class: ["btn", "join-item", (@offset.positive? ? nil : "btn-disabled")] %>

      <%= link_to "Next »",
                  url_for(request.query_parameters.merge(offset: @next_off, limit: @limit)),
                  class: ["btn", "join-item", (@has_next ? nil : "btn-disabled")] %>
    </div>
  </div>

</div>
